---
title: "CÃ¡lculo de Probabilidades en IMDb"
author: "Enrique DÃ­az Ocampo"
date: "`r Sys.Date()`"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

# 11ï¸âƒ£ IntroducciÃ³n

Este anÃ¡lisis tiene como objetivo calcular probabilidades condicionales en el dataset de IMDb, respondiendo preguntas como:

- Â¿CuÃ¡l es la probabilidad de que una pelÃ­cula con alto presupuesto tenga una alta recaudaciÃ³n?

- Â¿CÃ³mo influye el gÃ©nero de la pelÃ­cula en su calificaciÃ³n (score)?

- Â¿QuÃ© tan probable es que una pelÃ­cula de cierto paÃ­s tenga un presupuesto alto?

Estos cÃ¡lculos permiten entender patrones en la industria del cine y su relaciÃ³n con el presupuesto, la recaudaciÃ³n y las calificaciones.

# 2ï¸âƒ£ Carga de LibrerÃ­as y ConfiguraciÃ³n

```{r}
install.packages("here",dependencies = TRUE)
library(here)           # Manejo de rutas dinÃ¡micas
source(here("reportes/Proy_Imdb/00_CONFIGURACION.r"))
```

```{r}
# ğŸ“Œ Cargar librerÃ­as necesarias
library(janitor)        # Limpieza de nombres de columnas
library(summarytools)   # Resumen estadÃ­stico detallado
library(ggplot2)        # GrÃ¡ficos
library(dplyr)          # ManipulaciÃ³n de datos
library(plotly)         # GrÃ¡ficos Interactivos

# ğŸ“Œ ConfiguraciÃ³n de grÃ¡ficos globales
theme_set(theme_minimal())

# ğŸ“Œ Cargar scripts de preprocesamiento
source(here("scripts/utils.r"))
source(here("scripts/1_preprocesamiento_esp_dataset.r"))
source(here("scripts/3_analisis_probabilidad.r"))

```


# 3ï¸âƒ£ Carga y Preprocesamiento de Datos

ğŸ“Œ Â¿QuÃ© hace esta funciÃ³n?

âœ” Limpia los nombres de las columnas.

âœ” Convierte variables categÃ³ricas en factores.

âœ” Filtra valores invÃ¡lidos.

âœ” Retorna un dataset listo para anÃ¡lisis.

```{r}
# ğŸ“Œ Cargar y preprocesar el dataset IMDb
imdb_data <- preprocesar_datos(here("datasets/imdb_data_limpio.csv"), "Imdb")

# Filtrar gÃ©neros con mÃ¡s de 50 pelÃ­culas
imdb_filtered <- imdb_data %>%
  group_by(genre) %>%
  filter(n() > 50) %>%
  ungroup()

```


# 4ï¸âƒ£ CÃ¡lculo de Probabilidades Condicionales

En esta secciÃ³n analizamos la relaciÃ³n entre presupuesto, recaudaciÃ³n, gÃ©nero y calificaciÃ³n de pelÃ­culas aplicando cÃ¡lculos de probabilidad condicional.

ğŸ“Œ Probabilidad de que una pelÃ­cula con alto presupuesto tenga alta recaudaciÃ³n

```{r}
# ğŸ“Œ Definir los bins para cada variable
bins_budget <- seq(0, max(imdb_filtered$budget_x, na.rm = TRUE), by = 50000000)  # Intervalos de $50M
bins_revenue <- seq(0, max(imdb_filtered$revenue, na.rm = TRUE), by = 100000000)  # Intervalos de $100M

# ğŸ“Œ Transformar los datos antes de calcular probabilidades
imdb_data_binned <- imdb_filtered %>%
  filter(budget_x > 0, revenue > 0) %>%  # Eliminamos valores nulos
  mutate(
    budget_x = cut(budget_x, breaks = bins_budget, include.lowest = TRUE),
    revenue = cut(revenue, breaks = bins_revenue, include.lowest = TRUE)
  )

# ğŸ“Œ Calcular la probabilidad condicional de recaudaciÃ³n dado el presupuesto
resultados_budget_vs_revenue <- calcular_probabilidades(
  data = imdb_data_binned,
  condicionante = "budget_x",
  objetivo = "revenue"
)

# ğŸ“Œ Mostrar resultados
cat("Tabla de contingencia:\n")
print(resultados_budget_vs_revenue$tabla_contingencia)

cat("\nProbabilidades condicionales:\n")
print(resultados_budget_vs_revenue$probabilidades_condicionales)

cat("\nProbabilidades marginales de recaudaciÃ³n:\n")
print(resultados_budget_vs_revenue$probabilidades_marginales)

```

## ğŸ“Œ Probabilidad de que una pelÃ­cula de cierto gÃ©nero tenga calificaciÃ³n alta

```{r}
# Calcular probabilidades
resultados_genre_vs_score <- calcular_probabilidades(
  data = imdb_filtered,
  condicionante = "genre",
  objetivo = "score",
  bins = 10  # Dividimos la calificaciÃ³n en 5 grupos
)

# ğŸ“Œ Mostrar resultados
cat("Tabla de contingencia:\n")
print(resultados_genre_vs_score$tabla_contingencia)

cat("\nProbabilidades condicionales:\n")
print(resultados_genre_vs_score$probabilidades_condicionales)

cat("\nProbabilidades marginales de score:\n")
print(resultados_genre_vs_score$probabilidades_marginales)

```



## ğŸ“Œ Probabilidad de que una pelÃ­cula de cierto paÃ­s tenga un alto presupuesto

```{r}
# Filtrar los 5 paÃ­ses con mÃ¡s pelÃ­culas en la base de datos
top_countries <- imdb_filtered %>%
  count(country, sort = TRUE) %>%
  top_n(5) %>%
  pull(country)

# Filtrar dataset con los paÃ­ses seleccionados
imdb_filtered_country <- imdb_filtered %>%
  filter(country %in% top_countries)

# Calcular probabilidades
resultados_country_vs_budget <- calcular_probabilidades(
  data = imdb_filtered_country,
  condicionante = "country",
  objetivo = "budget_x",
  bins = 5
)

# ğŸ“Œ Mostrar resultados
cat("Tabla de contingencia:\n")
print(resultados_country_vs_budget$tabla_contingencia)

cat("\nProbabilidades condicionales:\n")
print(resultados_country_vs_budget$probabilidades_condicionales)

cat("\nProbabilidades marginales de presupuesto:\n")
print(resultados_country_vs_budget$probabilidades_marginales)

```



## ğŸ“Š VisualizaciÃ³n de Resultados

### ğŸ“Š  Probabilidad de RecaudaciÃ³n segÃºn Presupuesto

```{r}
p_budget_vs_revenue <- visualizar_probabilidad_condicional(
  data = imdb_data_binned,
  condicionante = "budget_x",
  objetivo = "revenue",
  titulo = "Probabilidad de RecaudaciÃ³n segÃºn Presupuesto en IMDb",
  xlab = "Presupuesto (USD)",
  guardar = TRUE,
  ruta_guardado = here("reportes/Proy_Imdb/resultados_generados/probabilidad_condicional_budget_vs_revenue.png"),
  bins = bins_budget
) 

p_budget_vs_revenue <- p_budget_vs_revenue %>% 
  layout(xaxis = list(tickangle = 90))  # Rotar etiquetas del eje X a 90 grados

# Mostrar el grÃ¡fico con etiquetas rotadas
p_budget_vs_revenue


```


### ğŸ“Š Probabilidad de GÃ©nero segÃºn CalificaciÃ³n

```{r}
# Filtrar gÃ©neros con al menos 50 pelÃ­culas
filtered_genres <- imdb_filtered %>%
  group_by(genre) %>%
  filter(n() > 250) %>%
  ungroup()

# Generar el grÃ¡fico con los gÃ©neros filtrados
p_genre_vs_score <- visualizar_probabilidad_condicional(
  data = filtered_genres,
  condicionante = "genre",
  objetivo = "score",
  titulo = "Probabilidad de GÃ©nero segÃºn CalificaciÃ³n en IMDb",
  xlab = "GÃ©nero",
  guardar = TRUE,
  ruta_guardado = here("reportes/Proy_Imdb/resultados_generados/probabilidad_condicional_genre_vs_score.png"),
  bins=10
) %>% layout(xaxis = list(tickangle = 90))  # Aplicar la rotaciÃ³n

# Mostrar el grÃ¡fico corregido
p_genre_vs_score


```




### ğŸ“Š Probabilidad de Presupuesto segÃºn PaÃ­s

```{r}
p_country_vs_budget <- visualizar_probabilidad_condicional(
  data = imdb_filtered_country,
  condicionante = "country",
  objetivo = "budget_x",
  titulo = "Probabilidad de Presupuesto segÃºn PaÃ­s en IMDb",
  xlab = "PaÃ­s",
  guardar = TRUE,
  ruta_guardado = here("reportes/Proy_Imdb/resultados_generados/probabilidad_condicional_country_vs_budget.png"),
  bins=10
)

p_country_vs_budget


```
















































